# McAfee Bug Can Be Exploited to Gain Windows SYSTEM Privileges
### McAfee has patched two high-severity bugs in its Agent component, one of which can allow attackers to achieve arbitrary code execution with SYSTEM privileges.

## Information:
+ Source: ThreatPost
+ Link: https://kasperskycontenthub.com/threatpost-global/?p=177857
+ Date: 2022-01-21T17:13:03+00:00
+ Author: Lisa Vaas


## Article:
![Article Image](https://media.threatpost.com/wp-content/uploads/sites/103/2022/01/21115841/mcafee.jpeg)

McAfee has patched two high-severity vulnerabilities in a component of its McAfee Enterprise product that attackers can use to escalate privileges, including up to SYSTEM.


According to McAfee’s [bulletin](https://kc.mcafee.com/corporate/index?page=content&id=SB10378), the bugs are in versions prior to 5.7.5 of [McAfee Agent,](https://www.mcafee.com/enterprise/en-us/downloads/trials/epo-mcafee-agent-deployment.html#:~:text=The%20McAfee%20Agent%20is%20the,such%20as%20deployment%20and%20updating.&text=The%20agent%20collects%20and%20sends,to%20the%20McAfee%20ePO%20server.) which is used in McAfee Endpoint Security, among other McAfee products.


The Agent is the piece of McAfee ePolicy Orchestrator (McAfee ePO) that downloads and enforces policies and executes client-side tasks such as deployment and updating.


The McAfee Agent is also the component that uploads events and provides additional data regarding each system’s status. Periodically collecting and sending event information to the McAfee ePO server, the Agent – which also installs and updates endpoint products – is a required install on any network system that needs to be managed.


OpenSSL Component Bug Can Lead to SYSTEM Privileges
---------------------------------------------------


One of the flaws in the Agent – tracked as CVE-2022-0166 and given a CVSS base criticality rating of 7.8 – was discovered by Will Dormann of the Carnegie Mellon University’s CERT Coordination Center (CERT/CC).


On Thursday, CERT/CC published an [advisory](https://kb.cert.org/vuls/id/287178) that said that the vulnerability is found in an OpenSSL component in Agent that specifies an OPENSSLDIR variable as a subdirectory that “[may] be controllable by an unprivileged user on Windows.”[![Password Management Webinar](https://media.threatpost.com/wp-content/uploads/sites/103/2022/01/12124026/specops_300x250_watch.jpg)](https://threatpost.com/webinars/password-reset-claiming-control-of-credentials-to-stop-attacks/)


According to the advisory, McAfee Agent “contains a privileged service that uses this OpenSSL component. A user who can place a specially crafted openssl.cnf file at an appropriate path may be able to achieve arbitrary code execution with SYSTEM privileges.”


Dormann found that an unprivileged user could exploit the bug to place a specially crafted openssl.cnf in a location used by McAfee Agent and thus potentially be able to execute arbitrary code with SYSTEM privileges on a Windows system that has the vulnerable McAfee Agent software installed.


When Dormann referred to an [openssl.cnf](https://www.microfocus.com/documentation/visual-cobol/VC40/CSWin/HROSSROPEN02.html), he was talking about an OpenSSL configuration file: a file that provides SSL defaults for items such as certificate files locations, and site details such as those entered during installation.


Arbitrary Shell Code
--------------------


The second bug in the Agent – tracked as CVE-2021-31854 and given a CVSS criticality rating of 7.7 – can be exploited by a local user to inject arbitrary shell code into a file, McAfee said in its advisory. “An attacker can exploit the security hole to obtain a reverse shell that allows them to gain root privileges,” according to the company.


The vulnerability, which is still pending analysis by its discoverer – Russell Wells from Cyberlinx Security – is a command-injection vulnerability in McAfee Agent for Windows prior to 5.7.5. McAfee said that it allows local users to inject arbitrary shell code into the file cleanup.exe.


“The malicious clean.exe file is placed into the relevant folder and executed by running the McAfee Agent deployment feature located in the System Tree,” according to McAfee. “An attacker may exploit the vulnerability to obtain a reverse shell which can lead to privilege escalation to obtain root privileges.”


Wells told [Security Week](https://www.securityweek.com/high-severity-vulnerabilities-patched-mcafee-enterprise-product) that exploiting this bug requires access to the McAfee ePO host, as in, the underlying Windows host, not the application itself.


Elevated Access Lets Threat Actors Run Amok
-------------------------------------------


Exploiting [privilege-escalation](https://threatpost.com/windows-10-privilege-escalation-zero-day-unofficial-fix/176313/) bugs lets threat actors paw at resources that should normally be locked safely away. Attackers can use those elevated privileges to steal confidential data, run administrative commands, read files from the file system and deploy malware, as well as to potentially evade detection during attacks.


This isn’t the first time that privilege-escalation bugs have turned up in McAfee’s Agent. A few months ago, in September, the security firm [patched one such bug](https://clement.notin.org/blog/2020/09/12/CVE-2020-7315-McAfee-Agent-DLL-injection/) (CVE-2020-7315) that was discovered by Tenable security researcher Clément Notin.


That earlier bug involved DLL injection in McAfee Agent that could have allowed a local administrator to kill or tamper with the antivirus, without knowing the McAfee password.


*Photo courtesy of [M.O. Stevens](https://commons.wikimedia.org/wiki/File:McAfee_office_-_Hillsboro,_Oregon.JPG).* *[Licensing details](https://creativecommons.org/licenses/by-sa/3.0/).* 





## Tags:

#### Action:
[[action.malware.name=at]] [[action.malware.name=Derusbi]] [[action.malware.name=Net]] [[action.malware.name=njRAT]] [[action.malware.name=Reg]] [[action.malware.name=Tor]]

#### Industry:
[[victim.industry.name=Accomodation]] [[victim.industry.name=Education]]

#### Location:
[[victim.country.name=Mali]] [[victim.continent.name=Africa]] [[victim.city.name=Berlin]] [[victim.country.name=Germany]] [[victim.continent.name=Europe]] [[victim.city.name=]] [[victim.country.name=Haiti]] [[victim.continent.name=North and Central America]]

### Autogenerated Tags:
[[Mcafee]] [[Openssl]] [[Dormann]] [[Openssl.cnf]] [[Windows]] [[ThreatPost]]
#### CVE's
[[CVE-2022-0166]] [[CVE-2021-31854]] [[CVE-2020-7315]]

