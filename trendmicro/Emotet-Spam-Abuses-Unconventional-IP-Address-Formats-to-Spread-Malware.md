# Emotet Spam Abuses Unconventional IP Address Formats to Spread Malware
### We found waves of Emotet spam campaigns using unconventional IP addresses to evade detection.

## Information:
+ Source: Trend Micro
+ Link: https://www.trendmicro.com/en_us/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-spread-malware.html
+ Date: 2022-01-21
+ Author: None


## Article:
![Article Image](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/cover-emotet-using-unconventional-octal-hexadecimal-IP-addresses-spam-campaign-evasion-technique.jpg)





We observed [Emotet](https://www.trendmicro.com/en_us/research/21/c/emotet-one-month-after-the-takedown.html) spam campaigns using hexadecimal and octal representations of IP addresses, likely to evade detection via pattern matching. Both routines use social engineering techniques to trick users into enabling document macros and automate malware execution. Upon receiving these standards, operating systems (OS) automatically convert the values to the dotted decimal quad representation to initiate the request from the remote servers. Users and businesses are cautioned to detect, block, and enable the relevant security measures to prevent compromise using Emotet for second stage delivery of malware such as TrickBot and Cobalt Strike.


Routine using hexadecimal IP addresses


The samples we found start with an email-attached document using Excel 4.0 Macros, a dated feature used to automate repetitive tasks in Excel that malicious actors have [abused](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/analysis-suspicious-very-hidden-formula-on-excel-4-0-macro-sheet) to deliver malware. Abuse of the feature in this case allows the malware to execute once the document is opened using the *auto\_open* macro.Â 






![fig1-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure1-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 1. Attached document in the emails lures users into enabling the macros





The URL is obfuscated with carets and the host contains a hexadecimal representation of the IP address. Using [CyberChef](https://gchq.github.io/CyberChef/), we converted the hexadecimal numbers to find the more commonly used dotted decimal equivalent, 193[.]42[.]36[.]245.






![fig2-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure2-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 2. Using carets for obfuscation




![fig3-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure3-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 3. Converting the hexadecimal numbers to dotted decimal representation




Once executed, the macro invokes *cmd.exe > mshta.exe* with the URL containing the hex representation of the IP address as an argument, which will download and execute an HTML application (HTA) code from the remote host.






![fig4-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure4-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 4. Downloading and executing an HTA code




Routine using octal IP addresses


Much like the hexadecimal representation sample, the document also uses Excel 4.0 Macros to run the malware once the document is opened and enabled. The URL is also obfuscated with carets but the IP contains an octal representation. We also used CyberChef to decode this IP address into a dotted quad format, 46[.]105[.]81[.]76.






![fig5-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure5-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 5. Using similar techniques with the hex decimal routine but with octal representation for obfuscation




![fig6-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure6-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 6. Converting the octal numbers to dotted decimal representation




As observed in the process tree, once executed, the macro also invokes *cmd.exe > mshta.exe* with the URL as an argument to download and execute an HTA code from the remote host.






![fig7-emotet-spam-abuse-octal-hexadecimal-IP-addresses-evade-detection](https://marvel-b1-cdn.bc0a.com/f00000000017219/www.trendmicro.com/content/dam/trendmicro/global/en/research/22/a/emotet-spam-abuses-unconventional-ip-address-formats-to-spread-malware/figure7-emotet-spam-using-unconventional-octal-hexadecimal-IP-addresses-evasion-technique.png)
Figure 7. Downloading and executing an HTA file




Conclusion


Traces of Emotet were observed as arbitrarily dropping Cobalt Strike beacons between November and December 2021. Earlier this year, however, operators became noticeably selective on which targets the beacons were dropped. Evasion techniques like these could be considered evidence of attackers continuing to innovate to thwart pattern-based detection solutions.


Moreover, the unconventional use of hexadecimal and octal IP addresses may result in evading current solutions reliant on pattern matching. But in the same vein, the unusual technique in the command lines can be used as a detection opportunity, with security teams using filters as leverage that can be enabled to treat such IP addresses as suspicious and associate them with malware.


Indicators of compromise (IOCs)








| SHA256 | Description | Detections |
| e492f31ca20d99888b2434dcb4d9af1f93ed4c485b9bd2bc550ce8ae8021b9cd | Hexadecimal IP address sample | Trojan.XF.HIDDBOOK.SMTH |
| 3e9701129f13f13f7b873f55dc3d43d04cbd1dd3f85814270bb1b177394926b5 | Octal IP address sample | Trojan.XF.EMOTET.SMYXBLAA |






URLs


193[.]42[.]36[.]245


46[.]105[.]81[.]76








## Tags:

#### Action:
[[action.malware.name=at]] [[action.malware.name=at]] [[action.malware.name=cmd]] [[action.malware.name=cmd]] [[action.malware.name=Cobalt Strike]] [[action.malware.name=Conti]] [[action.malware.name=Emotet]] [[action.malware.name=Ping]] [[action.malware.name=Ping]] [[action.malware.name=Tor]] [[action.malware.name=TrickBot]]

#### Location:
[[victim.country.name=Mali]] [[victim.continent.name=Africa]] [[victim.city.name=]] [[victim.country.name=Haiti]] [[victim.continent.name=North and Central America]]

### Autogenerated Tags:
[[Ip]] [[Malware]] [[Url]] [[Emotet]] [[Hta]] [[Trend Micro]]
#### SHA256-hash
e492f31ca20d99888b2434dcb4d9af1f93ed4c485b9bd2bc550ce8ae8021b9cd 3e9701129f13f13f7b873f55dc3d43d04cbd1dd3f85814270bb1b177394926b5

