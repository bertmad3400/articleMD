# Microsoft temporarily disables MSIX protocol handler following malware abuse
### Microsoft has temporarily disabled the MSIX protocol handler in Windows installations after the Emotet gang has abused it over the past three months to deploy malware on user systems.

## Information:
+ Source: The Record
+ Link: https://therecord.media/microsoft-temporarily-disables-msix-protocol-handler-following-malware-abuse/
+ Date: 2022-02-07T11:43:20+00:00
+ Author: Catalin Cimpanu


## Article:
![Article Image](https://therecord.media/wp-content/uploads/2022/02/windows-microsoft.jpg)

Microsoft has temporarily disabled the MSIX protocol handler in Windows installations after the Emotet gang has abused it over the past three months to deploy malware on user systems.


The OS maker said it is working on ways to better protect this feature from future abuse but did not say when it expects to re-enable it back on.


### What is MSIX and the “ms-appinstaller” protocol handler


Developed specifically for the launch of Windows 10, [MSIX](https://docs.microsoft.com/en-us/windows/msix/overview) is a new file packaging format was designed around the concept of XML manifest files where developers can describe how the installation process can occur, what files are needed, and from where they can be retrieved.


![MSIX-format](https://therecord.media/wp-content/uploads/2022/02/MSIX-format.png)Image: Microsoft
While it was initially made available for modern Windows versions, MSIX was backported to as far back as Windows 7 via MSIX Core, and today, MSIX-packaged files can be installed on all Windows OS versions.


Typically, these files are served with extensions such as APPX or APPXBUNDLE, containing all the resources needed to install on any OS version. But when users double-click and execute the file, the OS reads the manifest files and only installs the files needed for their platform.


However, for convenience, MSIX-packaged files can also be delivered via the internet via the “**ms-appinstaller**” protocol, which allows developers to create links like “*ms-appinstaller:?source=//website.com/file.appx*“.


In these instances, the MSIX protocol handler (ms-appinstaller) initially serves only the manifest XML files, and the OS only retrieves the files they need, saving bandwidth for the user.


### How MSIX attacks have been taking place


But in late November 2021, the operators of the Emotet malware botnet have started abusing ms-appinstaller links for attacks against enterprise users.


The group began sending emails, luring users to malicious sites. These sites would claim to contain important documents that recipients needed to view, but for which they needed to install a PDF component.


But this link to the PDF component was actually an “ms-appinstaller://” that claimed to install an Adobe-signed file, but in reality, it installed a version of the BazaarLoader malware.




> BREAKING: [#Emotet](https://twitter.com/hashtag/Emotet?src=hash&ref_src=twsrc%5Etfw) malspam links can since yesterday link to an Universal App installer hosted on [@azure](https://twitter.com/Azure?ref_src=twsrc%5Etfw) imposing as an Adobe Update that drops E4 payload. This is the same initial attack vector as [#BazarLoader](https://twitter.com/hashtag/BazarLoader?src=hash&ref_src=twsrc%5Etfw) used a few weeks ago, even using the same [@SectigoHQ](https://twitter.com/SectigoHQ?ref_src=twsrc%5Etfw) cert. [pic.twitter.com/B19KGFUtII](https://t.co/B19KGFUtII)
> 
> — Cryptolaemus (@Cryptolaemus1) [November 26, 2021](https://twitter.com/Cryptolaemus1/status/1464211328499916813?ref_src=twsrc%5Etfw)



The problem with these attacks, and the reason why Microsoft disabled the protocol handler, was that the Emotet gang found a way to spoof signatures in MSIX-packaged files.


While Microsoft delivered an initial patch for this issue ([CVE-2021-43890](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2021-43890)) back in December—and even provided Group Policy-based defenses for those who could not update—attacks have continued to take place.


Microsoft’s recent move comes to curtail attacks abusing ms-appinstaller links by disabling the protocol handler itself. This means that these links will not work anymore.


“If you utilize the ms-appinstaller protocol on your website, we recommend that you update the link to your application, removing ‘*ms-appinstaller:?source=*‘ so that the MSIX package or App Installer file will be downloaded to user’s machine,” [Microsoft said last week](https://techcommunity.microsoft.com/t5/windows-it-pro-blog/disabling-the-msix-ms-appinstaller-protocol-handler/ba-p/3119479).


“We recognize that this feature is critical for many enterprise organizations,” it added. “We are looking into introducing a Group Policy that would allow IT administrators to re-enable the protocol and control usage of it within their organizations.”





## Tags:

#### Action:
[[action.malware.name=at]] [[action.malware.name=Bazar]] [[action.malware.name=Conti]] [[action.malware.name=Emotet]] [[action.malware.name=Net]] [[action.malware.name=Tor]]

#### Industry:
[[victim.industry.name=Information]]

#### Location:
[[victim.country.name=Mali]] [[victim.continent.name=Africa]] [[victim.city.name=]] [[victim.country.name=Haiti]] [[victim.continent.name=North and Central America]]

### Autogenerated Tags:
[[Msix]] [[Microsoft]] [[Windows]] [[Emotet]] [[Malware]] [[Msix-packaged]] [[Ms-appinstaller]] [[The Record]]
#### urls
appinstaller://”
#### CVE's
[[CVE-2021-43890]]

